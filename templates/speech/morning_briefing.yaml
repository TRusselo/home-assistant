>
  {# Morning Report #}
  {%- macro getReport() -%}
    <p>
      {% if now().strftime('%H')|int < 12 and now().strftime('%H')|int > 6 %}
        Good morning.
      {% elif now().strftime('%H')|int >= 12 and now().strftime('%H')|int < 17 %}
        Good afternoon.
      {% else %}
        Good evening.
      {% endif %}
      </p>
      <p>
      {% if now().strftime('%H')|int < 12 %}
        {% if now().strftime('%M')|int == 0 %}
          It is {{ now().strftime('%H')|int }} AM.
        {% else %}
          It is {{ now().strftime('%H')|int }} {{ now().strftime('%M')|int }} AM.
        {% endif %}

      {% elif now().strftime('%H')|int > 12 %}
        {% if now().strftime('%M')|int == 0 %}
          It is {{ now().strftime('%H')|int }} PM.
        {% else %}
          It is {{ now().strftime('%H')|int }} {{ now().strftime('%M')|int }} PM.
        {% endif %}
      
      {% else %}

      {% endif %}
      </p>
      <p>
      {{ [
          'Today is ',
          'If you have not been keeping track today is ',
          'Do you know what day of the week it is? Today is',
          'I hate to be the bearer of bad news, but today is '
      ]|random }}
      {{states.sensor.sensor.dayoftheweek.state }}.
      </p>
      <p>
        It is currently {{states.weather.openweathermap.state}} and feels like {{states.sensor.openweathermap_feels_like_temperature.state|round}} degrees in Fort McMurray. 
      </p>
      <p>
        {% if states.sensor.canada_weatheralerts_active_alerts.state | int > 0 %}
          There are currently {{states.sensor.canada_weatheralerts_active_alerts.state }} active weather alerts for our area.
          The National Weather Service Has issued,
          {% if states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[5] is defined %}
            a {{ states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[5] }}.
          {% elif states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[4] is defined %}
          a {{ states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[4] }}.
          {% elif states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[3] is defined %}
            a {{ states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[3] }}.
          {% elif states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[2] is defined %}
            a {{ states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[2] }}.
          {% elif states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[1] is defined %}
            a {{ states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[1] }}.
          {% else %}
            a {{ states.sensor.canada_weatheralerts_active_alerts.attributes.spoken_desc.split('\n\n-\n\n')[0] }}.
          {% endif %}
        {% endif %}
      </p>
      <p>
        {{ [
            'The rest of the day should be,',
            'Todays forecast should be ,'
        ]|random }}
          {{ states.sensor.nws_current_forecast.state }} 
        </p>
        <p>
        {% if is_state('sensor.holiday_halloween','0') %}
          Happy Halloween!
        {% endif %}
        {% if is_state('sensor.holiday_christmas','0') %}
          Merry Christmas Everyone!
        {% endif %}
        {% if states.calendar.google_cal_birthdays.state == 'on' %}
          Today is {{ states.calendar.google_cal_birthdays.attributes.message }}! So Happy Birthday! The confetti cannon is not working otherwise I would shower you in paper garbage that someone else would have to pick up.
        {% endif %}
        {%- set event=states.calendar.holidays_in_canada.attributes.message %}
        {% if 'Day' in event and 'National' in event%}
          {{ [
            'And a very special Happy ',
            'It is also ',
            'Today is also known as ',
            'Oh <emphasis>Look</emphasis>. Today is ',
            'Want to know a fact? Today is ',
            'Everyday can be a holiday. So today is '
        ]|random }}
        {{states.calendar.holidays_in_canada.attributes.message | replace("&"," and ") }}.
        {%- endif -%}
        </p>
        <p>

  {%- endmacro -%}


  {# a macro that removes all newline characters, empty spaces, and returns formatted text  #}
    {%- macro cleanup(data) -%}
      {%- for item in data.split("\n")  if item | trim != "" -%}
        {{ item | trim }} {% endfor -%}
  {%- endmacro -%}

  {# a macro to call all macros :)  #}
    {%- macro mother_of_all_macros() -%}
      {{ getReport() }}
    {%- endmacro -%}
    
    {# Call the macro  #}
    {{- cleanup(mother_of_all_macros()) -}}